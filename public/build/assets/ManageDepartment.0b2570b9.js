import{_ as N,s as z,x as p,c as r,g as h,w as a,k as y,d as i,F as w,r as c,o as n,e as u,t as m,i as v,b as o,h as b,z as P,v as q,T as x}from"./app.a30414ce.js";const M={created(){this.loadDepartment(),this.getAllSchoolYears()},data(){return{search:"",name:"",filterBy:"none",departments:[],selectedDeparment:[],selectedShool:null,isFetching:!1,isUpdating:!1,isSaving:!1,isDeleting:!1,requestError:null,validationError:{},showForm:!1,departmentSelected:null,school_years:[],schools:[],selected_school:null,selected_school_year:null,isSchoolYearFetching:!1,requestHasError:null}},computed:{...z(["User"])},watch:{search(l,e){this.searDepartment()}},methods:{changeHandler(l){let e=this.school_years.find(f=>f.id==l.target.value);this.schools=e.schools,this.selected_school=null,this.schools.length>0&&(this.selected_school=this.schools[0].id)},async getAllSchoolYears(){this.isSchoolYearFetching=!0,await p.get("api/school-year-with-schools").then(l=>{this.school_years=l.data.data,this.school_years.length>0&&(this.selected_school_year=this.school_years[0].id,this.schools=this.school_years[0].schools,this.schools.length>0&&(this.selected_school=this.schools[0].id))}).catch(l=>{this.hasRequestError='"Oops! It seems like there was an error when  fetchin information school year, Please check your network connection. o and try again. if you think it it was the system please do contact the developer'}).finally(()=>{this.isSchoolYearFetching=!1})},searDepartment:_.debounce(async function(){await p.post("api/manage-department-search",{search:this.search}).then(l=>{this.departments=l.data.data})},300),handleShowForm(l,e){this.validationError={},e=="add"&&(this.name="",this.departmentSelected=null),e=="update"&&(this.departmentSelected=l,this.departmentSelected.school!=null&&(this.selected_school=this.departmentSelected.school.id),this.departmentSelected.school.school_year!=null&&(this.selected_school_year=this.departmentSelected.school.school_year.id),console.log(this.departmentSelected),this.name=l.name),this.showForm=!0},async deleteAllDepartment(){this.customConfirmationDialog({title:"Are you sure do you want to delete all departments?",passFunction:async()=>{this.isDeleting=!0,await p.post("api/manage-department-delete-all").then(l=>{this.loadDepartment()}).catch(l=>{this.requestHasError='"Oops! It seems like there was an error when  deleting department, Please check your network connection. o and try again. if you think it it was the system please do contact the developer'}).finally(()=>{this.isDeleting=!1})}})},customConfirmationDialog({title:l="Are you sure?",text:e="You won't be able to revert this!",icon:f="warning",confirmButtonText:S="Yes, delete it!",passFunction:t,passCancelFunction:d}){this.$swal({title:l,text:e,icon:f,showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:S}).then(async k=>{k.isConfirmed&&t()})},async deleteSelectedDepartment(){this.customConfirmationDialog({title:"Are you sure do you want to delete selecred departments?",passFunction:async()=>{const l=[];this.selectedDeparment.forEach(e=>{l.push(e.id)}),this.isDeleting=!0,await p.post("api/manage-department-delete-selected",{deparmentid:l}).then(e=>{this.selectedDeparment=[],this.loadDepartment()}).catch(e=>{this.requestHasError='"Oops! It seems like there was an error when  when deleting department, Please check your network connection. o and try again. if you think it it was the system please do contact the developer'}).finally(()=>{this.isDeleting=!1})}})},async loadDepartment(){this.isFetching=!0,await p.get("api/manage-department").then(l=>{this.departments=l.data.data}).catch(l=>{this.requestHasError='"Oops! It seems like there was an error when  fetchin departments, Please check your network connection. o and try again. if you think it it was the system please do contact the developer'}).finally(()=>{this.isFetching=!1})},async createDepartment(){let l={school_id:this.selected_school,school_year_id:this.selected_school_year,name:this.name};this.isSaving=!0,await p.post("api/manage-department-create",l).then(e=>{this.selected_school=null,this.selected_school_year=null,this.showForm=!1,this.name="",this.loadDepartment(),this.getAllSchoolYears()}).catch(e=>{e.response.status===422?this.validationError=e.response.data.errors:this.requestHasError='"Oops! It seems like there was an error when creating department, Please check your network connection. o and try again. if you think it it was the system please do contact the developer'}).finally(()=>{this.isSaving=!1})},async updateDepartment(){this.isSaving=!0;let l={school_id:this.selected_school,school_year_id:this.selected_school_year,name:this.name,id:this.departmentSelected.id};await p.post("api/manage-department-update",l).then(e=>{this.departmentSelected=null,this.selected_school=null,this.selected_school_year=null,this.name="",this.showForm=!1,this.loadDepartment(),this.getAllSchoolYears()}).catch(e=>{e.response.status===422?this.validationError=e.response.data.errors:this.requestHasError='"Oops! It seems like there was an error when  updating  department school year, Please check your network connection. o and try again. if you think it it was the system please do contact the developer'}).finally(()=>{this.isSaving=!1})}}},R=o("p",{index:"40px",class:"text-white font-rubok text-base font-semibold"}," - Be aware deleting a university will also delete all related data. ",-1),G=o("p",{index:"40px",class:"text-white font-rubok text-base font-semibold"}," - There should be atleast one university exist before you can create an organization. ",-1),j=o("i",{class:"fa-solid fa-plus mr-1"},null,-1),L=u(" Add Organization "),J=o("i",{class:"fa-regular fa-trash-can mr-2"},null,-1),K=o("i",{class:"fa-regular fa-trash-can mr-1"},null,-1),Q=o("span",{class:"block"},"Delete All",-1),W={class:"relative w-12 px-6 sm:w-16 sm:px-8"},X=["value"],Z={class:"text-sm"},$={class:"flex items-center"},ee={class:""},te={class:"font-medium text-gray-900"},se={class:"text-sm"},oe={class:"text-sm"},ne={class:"flex items-center"},le={class:""},ae={key:0,class:"font-medium text-gray-900"},re=u("None"),ie={class:"py-2 text-sm text-gray-500"},ce=["onClick","disabled"],he=o("i",{class:"fa-regular fa-pen-to-square"},null,-1),de=[he],ue={key:0,class:"mt-4"},me=o("p",{class:"text-base font-rubik text-gray-800"},"School Year",-1),_e=u(" Empty "),pe=["value"],ye={key:1,class:"mt-4"},ge=o("p",{class:"text-base font-rubik text-gray-800"},"University",-1),fe=u("Empty "),we=["value"],ke={class:"mt-4"},ve={class:""},be=o("p",{class:"text-base font-rubik text-gray-800"},"Organization Name",-1),xe=o("div",{class:"my-4"},null,-1),Se={class:"my-2 flex justify-end"},De=u(" Close "),Ce={key:0,class:"my-1 mx-2"},Ee={key:1},Be={key:0},Fe=u(" Save "),qe=u(" Update "),Ve={class:"flex items-center"},Ye=o("p",{class:"text-base mr-2"},"Deleting Organization",-1);function Ae(l,e,f,S,t,d){const k=c("InstructionCard"),g=c("TableButton"),V=c("BaseSearchInput"),Y=c("BaseTableSetup"),D=c("StatusCard"),A=c("BaseTable"),C=c("NoDataCard"),I=c("BaseInput"),E=c("BaseSpinner"),B=c("BaseDialog"),O=c("RequestError"),H=c("BaseErrorDialog"),T=c("GlobalErrorCard"),U=c("BaseCard");return n(),r(w,null,[l.User.hasRoleOf(["sbo-adviser"])?(n(),h(k,{key:0,class:"mb-4 shadow pulse",title:"Note "},{default:a(()=>[R,G]),_:1})):y("",!0),i(U,{subtitle:"Manage Organizations"},{header:a(()=>[i(Y,null,{"searchs-area":a(()=>[i(g,{class:"mr-2",onClick:e[0]||(e[0]=s=>d.handleShowForm(null,"add"))},{default:a(()=>[j,L]),_:1}),i(V,{placeholder:"Search Name ...",modelValue:t.search,"onUpdate:modelValue":e[1]||(e[1]=s=>t.search=s)},null,8,["placeholder","modelValue"])]),"filters-area":a(()=>[]),"actions-area":a(()=>[t.selectedDeparment.length>0?(n(),h(g,{key:0,onClick:d.deleteSelectedDepartment,mode:!0,class:"mr-2"},{default:a(()=>[J,u(" Selected ( "+m(t.selectedDeparment.length)+" ) ",1)]),_:1},8,["onClick"])):y("",!0),t.departments.length>0&&t.selectedDeparment.length<=0?(n(),h(g,{key:1,onClick:d.deleteAllDepartment,mode:!0},{default:a(()=>[K,Q]),_:1},8,["onClick"])):y("",!0)]),_:1})]),default:a(()=>[i(A,{thdata:["","Organizations","University","School Year",""],isFetching:t.isFetching},{data:a(()=>[(n(!0),r(w,null,v(t.departments,s=>(n(),r("tr",{key:s.id},[o("td",W,[b(o("input",{"onUpdate:modelValue":e[2]||(e[2]=F=>t.selectedDeparment=F),value:s,type:"checkbox",class:"absolute left-4 top-1/2 -mt-2 h-4 w-4 accent-green-600 text-white rounded border-gray-200 sm:left-6"},null,8,X),[[P,t.selectedDeparment]])]),o("td",Z,[o("div",$,[o("div",ee,[o("div",te,m(s.name),1)])])]),o("td",se,[s.school!=null?(n(),h(D,{key:0,class:"bg-green-700 text-white"},{default:a(()=>[u(m(s.school.name),1)]),_:2},1024)):y("",!0)]),o("td",oe,[o("div",ne,[o("div",le,[s.school!=null&&s.school.school_year!=null?(n(),r("div",ae,"SY."+m(s.school.school_year.from)+" - "+m(s.school.school_year.to),1)):(n(),h(D,{key:1,class:"font-medium bg-gray-700 text-white"},{default:a(()=>[re]),_:1}))])])]),o("td",ie,[o("button",{onClick:F=>d.handleShowForm(s,"update"),disabled:t.selectedDeparment.length>0,type:"button",class:"inline-flex items-center rounded-md border outline:none border-gray-300 bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-30 mr-1"},de,8,ce)])]))),128))]),_:1},8,["isFetching"]),(n(),h(x,{to:"#app"},[i(B,{show:t.showForm,width:"500",preventClose:!0},{"c-content":a(()=>[this.departmentSelected==null?(n(),r("section",ue,[o("div",null,[me,t.school_years.length<=0?(n(),h(C,{key:0},{default:a(()=>[_e]),_:1})):b((n(),r("select",{key:1,onChange:e[3]||(e[3]=(...s)=>d.changeHandler&&d.changeHandler(...s)),"onUpdate:modelValue":e[4]||(e[4]=s=>t.selected_school_year=s),class:"block w-full py-2 px-3 pr-8 rounded-md bg-white border border-gray-400 focus:outline-none focus:shadow-outline-green focus:border-green-500 sm:text-sm sm:leading-5"},[(n(!0),r(w,null,v(t.school_years,s=>(n(),r("option",{class:"",key:s.id,value:s.id}," SY. "+m(s.from)+" - "+m(s.to),9,pe))),128))],544)),[[q,t.selected_school_year]])])])):y("",!0),this.departmentSelected==null?(n(),r("section",ye,[o("div",null,[ge,t.schools.length<=0?(n(),h(C,{key:0},{default:a(()=>[fe]),_:1})):b((n(),r("select",{key:1,"onUpdate:modelValue":e[5]||(e[5]=s=>t.selected_school=s),class:"block w-full py-2 px-3 pr-8 rounded-md bg-white border border-gray-400 focus:outline-none focus:shadow-outline-green focus:border-green-500 sm:text-sm sm:leading-5"},[(n(!0),r(w,null,v(t.schools,s=>(n(),r("option",{key:s.id,value:s.id},m(s.name),9,we))),128))],512)),[[q,t.selected_school]])])])):y("",!0),o("section",ke,[o("div",ve,[be,i(I,{modelValue:t.name,"onUpdate:modelValue":e[6]||(e[6]=s=>t.name=s),hasError:t.validationError.name},null,8,["modelValue","hasError"])])]),xe,o("div",Se,[i(g,{mode:"",class:"mr-2",onClick:e[7]||(e[7]=s=>t.showForm=!1)},{default:a(()=>[De]),_:1}),t.isSaving?(n(),r("div",Ce,[i(E)])):(n(),r("div",Ee,[t.selected_school!=null?(n(),r("div",Be,[this.departmentSelected==null?(n(),h(g,{key:0,class:"",onClick:d.createDepartment},{default:a(()=>[Fe]),_:1},8,["onClick"])):(n(),h(g,{key:1,class:"",onClick:d.updateDepartment},{default:a(()=>[qe]),_:1},8,["onClick"]))])):y("",!0)]))])]),_:1},8,["show"])])),(n(),h(x,{to:"#app"},[i(H,{show:t.requestError!=null,width:"400",transition:"slide-fade-down"},{"c-content":a(()=>[i(O,{statusCode:t.requestError.statusCode,onClose:e[8]||(e[8]=s=>t.requestError=null),message:t.requestError.message},null,8,["statusCode","message"])]),"c-actions":a(()=>[]),_:1},8,["show"])])),(n(),h(x,{to:"#app"},[i(B,{show:t.isDeleting,width:"250"},{"c-content":a(()=>[o("div",Ve,[i(E,{class:"mx-2"}),Ye])]),_:1},8,["show"])])),i(T,{onClose:e[9]||(e[9]=s=>t.requestHasError=null),show:t.requestHasError!=null},null,8,["show"])]),_:1})],64)}const Oe=N(M,[["render",Ae]]);export{Oe as default};
