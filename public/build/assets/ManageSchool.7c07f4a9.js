import{s as M,x as u,_ as B,o as a,c as r,b as o,h as T,v as Y,F as b,i as S,t as g,k as w,d as m,g as y,w as c,e as k,r as d,z as I,T as U}from"./app.1c991082.js";const V={created(){if(this.getAllSchoolYears(),this.isUpdateMode){this.form={name:this.schoolData.name,files:[]},this.selected_school_year=this.schoolData.school_year;const e=[];this.schoolData.organizations.forEach(s=>{e.push(s.id)}),console.log(e),this.selectedOrganizations=e,this.existingFile=this.schoolData.files}},props:{organizationsData:{type:Array,default:[]},isUpdateMode:{type:Boolean,default:!1},schoolData:{type:Object,default:{}}},emits:["hasRequestError","close","hasUnsaveFile"],computed:{...M(["fileType"]),name(){return this.data},noExisintData(){return this.existingFile.length<=0}},data(){return{allowmultiple:!1,form:{name:"",files:[]},existingFile:[],organizations:this.organizationsData,selectedOrganizations:[],fileToBeRemove:[],isLoading:!1,isUploading:!1,isOrganizationFetching:!1,validationError:{},requestError:null,requestHasError:null,school_years:[],isSchoolYearFetching:!1,selected_school_year:null}},methods:{async getAllSchoolYears(){this.isSchoolYearFetching=!0,await u.get("api/school-year").then(e=>{this.school_years=e.data.data,this.isUpdateMode||this.school_years.length>0&&(this.selected_school_year=this.school_years[0].id)}).catch(e=>{this.requestHasError='"Oops! It seems like there was an error when  fetchin information school year, Please check your network connection. o and try again. if you think it it was the system please do contact the developer'}).finally(()=>{this.isSchoolYearFetching=!1})},handleClose(){if(this.form.files.length>0){const e=[];this.form.files.forEach(s=>{e.push(s.folder)}),this.$emit("hasUnsaveFile",e)}else this.$emit("close",!1)},removeExistingFile(e){const s=this.existingFile.find(n=>n.id==e);this.existingFile=this.existingFile.filter(n=>n.id!=e),this.fileToBeRemove.push(s),console.log(this.fileToBeRemove)},handleSubmit(){this.isUpdateMode?this.updateSchool():this.addSchool()},async updateSchool(){this.isLoading=!0,await u.put("api/schools/"+this.schoolData.id,{...this.form,filetoberemove:this.fileToBeRemove,organizations:this.selectedOrganizations,school_year:this.selected_school_year}).then(e=>{console.log(e.data),this.showToast({title:"Succesfully Update"}),this.form={name:"",files:[]},this.$emit("close",!0)}).catch(e=>{e.response.status===422?this.validationError=e.response.data.errors:this.$emit("hasRequestError",{statusCode:String(e.response.status),message:e.response.statusText})}).finally(()=>{this.isLoading=!1})},handleLoading(e){this.isUploading=e},async addSchool(){this.isLoading=!0,await u.post("api/schools",{...this.form,school_year:this.selected_school_year}).then(e=>{console.log(e),this.showToast({title:"Succesfully Update"}),this.form={name:"",files:[]},this.selectedOrganizations=[],this.$emit("close",!0)}).catch(e=>{e.response.status===422?this.validationError=e.response.data.errors:this.$emit("hasRequestError",{statusCode:String(e.response.status),message:e.response.statusText})}).finally(()=>{this.isLoading=!1})},setFile(e){const s=e;this.form.files.push(s)},removeFile(e){const s=e;this.form.files=this.form.files.filter(n=>n.folder!=s.folder)},showToast({title:e="Succesfully Saved"}){this.$swal({position:"top-end",icon:"success",showConfirmButton:!1,title:e,timer:1700,toast:!0,width:"300px",customClass:{title:"text-red"}})}}},R={key:0,class:"mt-4"},A=o("p",{class:"text-base font-bold"},"School Year",-1),L=["value"],O={class:"mt-4"},N=o("p",{class:"text-base font-bold"},"School Name",-1),H={key:1,class:"py-2 mt-4"},j=o("p",{class:"text-base font-bold"},"Attachment Type",-1),P={class:"py-2 flex flex-wrap"},G={key:2,class:"mt-4"},J=o("p",{class:"text-base font-bold"},"Featured Image",-1),K={class:"pt-2"},Q={class:"flex justify-end"},W={class:"flex justify-center items-center"},X={key:0,class:"bg-white px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},Z=["disabled"];function $(e,s,n,x,t,i){const p=d("BaseInput"),v=d("FileChip"),F=d("w-divider"),C=d("FilePondBase"),D=d("BaseSpinner");return a(),r("div",null,[n.isUpdateMode?w("",!0):(a(),r("section",R,[o("div",null,[A,T(o("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>t.selected_school_year=l),class:"block w-full py-2 px-3 pr-8 rounded-md bg-white border border-gray-400 focus:outline-none focus:shadow-outline-green focus:border-green-500 sm:text-sm sm:leading-5"},[(a(!0),r(b,null,S(t.school_years,l=>(a(),r("option",{key:l.id,value:l.id}," SY. "+g(l.from)+" "+g(l.to),9,L))),128))],512),[[Y,t.selected_school_year]])])])),o("div",O,[N,m(p,{modelValue:t.form.name,"onUpdate:modelValue":s[1]||(s[1]=l=>t.form.name=l),hasError:t.validationError.name},null,8,["modelValue","hasError"])]),n.isUpdateMode&&t.existingFile.length>0?(a(),r("div",H,[j,o("div",P,[(a(!0),r(b,null,S(t.existingFile,l=>(a(),y(v,{onClick:E=>i.removeExistingFile(l.id),class:"m-1",key:l.id},{default:c(()=>[k(g(l.file_name),1)]),_:2},1032,["onClick"]))),128))]),i.noExisintData?(a(),y(F,{key:0,class:"my-2"})):w("",!0)])):w("",!0),i.noExisintData?(a(),r("div",G,[J,m(C,{label:"Drag & Drop your image here or <u> Browse </u>",multiple:t.allowmultiple,fileType:e.fileType.image,onFileIsUploading:i.handleLoading,onFileIsUploaded:i.setFile,onFileIsDeleted:i.removeFile,class:"mt-2"},null,8,["multiple","fileType","onFileIsUploading","onFileIsUploaded","onFileIsDeleted"])])):w("",!0),o("div",K,[o("div",Q,[o("div",W,[o("button",{onClick:s[2]||(s[2]=(...l)=>i.handleClose&&i.handleClose(...l)),type:"button",class:"rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"}," Close "),t.isLoading?(a(),r("div",X,[m(D)])):(a(),r("button",{key:1,disabled:t.isLoading,onClick:s[3]||(s[3]=(...l)=>i.handleSubmit&&i.handleSubmit(...l)),class:"ml-3 inline-flex justify-center rounded-md border border-transparent bg-green-700 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},g(n.isUpdateMode?"Update":"Save"),9,Z))])])])])}const ee=B(V,[["render",$]]),se={components:{SchoolForm:ee},watch:{search(e,s){this.searchSchool()}},created(){this.loadSchool(),this.loadOrganizaions()},data(){return{arrays:{config:[]},page:1,search:"",schools:[],selectedSchool:[],organizations:[],showForm:!1,requestError:null,isFetching:!1,schoolData:null,isUpdateMode:!1}},methods:{async loadOrganizaions(){await u.get("api/manage-department").then(e=>{this.organizations=e.data.data}).catch(e=>{this.requestError=e})},async handleUnsaveFiles(e){this.customConfirmationDialog({title:"You have  unsave file upload in the form ",text:"Are you sure you want to close it",icon:"warning",confirmButtonText:"Yes ",passFunction:()=>{this.deleteTemporaryStorage(e)}})},async deleteTemporaryStorage(e){u.post("api/files/delete-temporary-files",{folders:e}).then(s=>{this.showForm=!1}).catch(s=>{this.requestError=s})},uploadFile(){var e=new OSS(this.arrays.config),s=this.$refs.attachment.files[0];console.log("file data",s),e.multipartUpload("temp/file/"+s.name,s,{parallel:4,progress:function(n,x,t){console.log("percentage ",n),console.log("cpt ",x),console.log("res ",t)},partclientSize:1*1024*1024})},async getToken(){await u.get("api/oss/token").then(({data:e})=>{console.log(e),this.arrays.config=e.data})},showTheForm(){this.schoolData={},this.showForm=!0,this.isUpdateMode=!1},clearSelectedSchool(){this.selectedSchool=[]},searchSchool:_.debounce(async function(){await u.post("api/schools/search",{search:this.search}).then(e=>{this.schools=e.data.data})},300),async deleteSelectedSchool(){this.customConfirmationDialog({passFunction:async()=>{await u.post("api/schools/delete-selected",{selectedSchool:this.selectedSchool}).then(e=>{this.loadSchool(),this.selectedSchool=[],this.$swal("Deleted!","Your data has been deleted.","success")}).catch(e=>{console.log(e),this.requestError=e})}})},async deleteAllRecord(){this.customConfirmationDialog({passFunction:async()=>{await u.post("api/schools/delete-all").then(e=>{this.loadSchool(),this.$swal("Deleted!","Your data has been deleted.","success")}).catch(e=>{this.requestError=e})}})},async loadSchool(){this.isFetching=!0,await u.get("api/schools").then(e=>{this.schools=e.data.data}).catch(e=>{console.log(e)}).finally(()=>{this.isFetching=!1})},async selectSchool(e,s){if(s==="update"){this.schoolData={};const n={id:e.id,name:e.name,files:e.files.length>0?[...e.files]:[],organizations:e.departments.length>0?[...e.departments]:[],school_year:e.school_year.id,created_at:e.created_at,update_at:e.update_at};this.schoolData=n,this.isUpdateMode=!0,this.showForm=!0}s=="delete"&&(this.isUpdateMode=!1,this.customConfirmationDialog({passFunction:()=>{this.deletesSchool(e.id)}}))},async deletesSchool(e){u.delete("api/schools/"+e).then(s=>{this.loadSchool(),this.$swal("Deleted!","Your data has been deleted.","success")}).catch(s=>{this.requestError=s})},customConfirmationDialog({title:e="Are you sure?",text:s="You won't be able to revert this!",icon:n="warning",confirmButtonText:x="Yes, delete it!",passFunction:t,passCancelFunction:i}){this.$swal({title:e,text:s,icon:n,showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:x}).then(async p=>{p.isConfirmed&&t()})},showErrorDialog(e){this.requestError=e},closeErrorDialog(){this.requestError=null},showError(){},closeForm(e){e&&this.loadSchool(),this.showForm=!1}}},te=o("i",{class:"fa-solid fa-plus mr-1"},null,-1),oe=k(" Add University "),ae=o("i",{class:"fa-regular fa-trash-can mr-2"},null,-1),ie=o("i",{class:"fa-regular fa-trash-can mr-1"},null,-1),le=o("span",{class:"block"},"Delete All",-1),ne={class:"relative w-12 px-6 sm:w-16 sm:px-8"},re=["value"],ce={tabindex:"0",class:"whitespace-normal pl-2 align-top font-semibold text-wrap focus:outline-none text-sm leading-none text-gray-800"},de={class:"whitespace-nowrap py-4 text-sm"},he={class:"flex items-center"},ue={class:"pl-1"},me={class:"font-medium capitalize text-sm pr-2 text-gray-900"},fe={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},ge={key:0},pe=["src","alt"],_e={key:1},ye={key:2,class:"flex items-centerh-24 w-24"},we=["src"],xe={class:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6"},be=["onClick"],Se=o("i",{class:"fa-regular fa-pen-to-square"},null,-1),ve=[Se],Fe=["disabled","onClick"],Ce=o("i",{class:"fa-regular fa-trash-can"},null,-1),De=[Ce];function ke(e,s,n,x,t,i){const p=d("TableButton"),v=d("BaseSearchInput"),F=d("BaseTableSetup"),C=d("BaseTable"),D=d("SchoolForm"),l=d("BaseDialog"),E=d("RequestError"),q=d("BaseErrorDialog"),z=d("BaseCard");return a(),y(z,{class:"relative",subtitle:"Manage University"},{header:c(()=>[m(F,null,{"searchs-area":c(()=>[m(p,{class:"mr-2",onClick:i.showTheForm},{default:c(()=>[te,oe]),_:1},8,["onClick"]),m(v,{placeholder:"Search Name ...",modelValue:t.search,"onUpdate:modelValue":s[0]||(s[0]=h=>t.search=h)},null,8,["placeholder","modelValue"])]),"filters-area":c(()=>[]),"actions-area":c(()=>[t.selectedSchool.length>0?(a(),y(p,{key:0,mode:!0,class:"mr-2",onClick:i.deleteSelectedSchool},{default:c(()=>[ae,k(" Selected ("+g(t.selectedSchool.length)+" ) ",1)]),_:1},8,["onClick"])):w("",!0),!t.selectedSchool.length>0&&t.schools.length>0?(a(),y(p,{key:1,mode:!0,onClick:i.deleteAllRecord},{default:c(()=>[ie,le]),_:1},8,["onClick"])):w("",!0)]),_:1})]),default:c(()=>[m(C,{thdata:[" ","School Year","University Name","Featured Image",""],isFetching:t.isFetching},{data:c(()=>[(a(!0),r(b,null,S(t.schools,h=>(a(),r("tr",{key:h.id},[o("td",ne,[T(o("input",{"onUpdate:modelValue":s[1]||(s[1]=f=>t.selectedSchool=f),type:"checkbox",value:h.id,class:"absolute left-4 top-1/2 -mt-2 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 sm:left-6"},null,8,re),[[I,t.selectedSchool]])]),o("td",null,[o("p",ce," SY."+g(h.school_year.from)+" -"+g(h.school_year.to),1)]),o("td",de,[o("div",he,[o("div",ue,[o("div",me,g(h.name),1)])])]),o("td",fe,[h.files.length>0?(a(),r("div",ge,[(a(!0),r(b,null,S(h.files,f=>(a(),r("img",{key:f.id,src:"/uploads/files/"+f.owned_by+"/"+f.folder+"/"+f.file_name,class:"h-24 w-24 rounded mx-2",alt:f.file_name},null,8,pe))),128))])):w("",!0),h.files.length>0?(a(),r("div",_e)):(a(),r("div",ye,[o("img",{src:"/assets/No-Image-Placeholder.svg.png",class:"rounded mx-2 w-full h-full",alt:"No Imaghe"},null,8,we)]))]),o("td",xe,[o("button",{onClick:f=>i.selectSchool(h,"update"),type:"button",class:"inline-flex items-center rounded-md border outline:none border-gray-300 bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-30 mr-1"},ve,8,be),o("button",{disabled:t.selectedSchool.length>0,onClick:f=>i.selectSchool(h,"delete"),type:"button",class:"inline-flex items-center rounded-md border outline:none border-gray-300 bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-30 mr-1"},De,8,Fe)])]))),128))]),ac:c(()=>[]),_:1},8,["isFetching"]),(a(),y(U,{to:"#app"},[m(l,{show:!!t.showForm,width:"600",preventClose:!0},{"c-content":c(()=>[m(D,{organizationsData:t.organizations,schoolData:t.schoolData,isUpdateMode:t.isUpdateMode,onClose:i.closeForm,onHasUnsaveFile:i.handleUnsaveFiles,onHasRequestError:i.showErrorDialog},null,8,["organizationsData","schoolData","isUpdateMode","onClose","onHasUnsaveFile","onHasRequestError"])]),_:1},8,["show"])])),(a(),y(U,{to:"#app"},[m(q,{show:t.requestError!=null,width:"400",transition:"slide-fade-down"},{"c-content":c(()=>[m(E,{statusCode:t.requestError.statusCode,onClose:i.closeErrorDialog,message:t.requestError.message},null,8,["statusCode","onClose","message"])]),"c-actions":c(()=>[]),_:1},8,["show"])]))]),_:1})}const Ue=B(se,[["render",ke]]);export{Ue as default};
