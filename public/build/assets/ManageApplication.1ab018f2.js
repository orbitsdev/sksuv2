import{_ as H,x,g as v,w as h,r as u,o as l,d,e as _,t as y,k as q,c as n,i as b,b as t,h as k,z as C,F as w,T as B,v as G,A as J,p as K,q as Q}from"./app.0b9d15e2.js";const W={data(){return{search:"",formtitle:"",showForm:!1,validationError:null,requestError:null,isSaving:!1,isFetching:!1,isUpdatingMode:!1,isApplicationFormFetching:!1,isRequirementLoading:!1,selectedRequirements:[],selectedApplicationForms:[],requirements:[],approvers:[1,2,3],applicationforms:[],selectedApplicationFormToUpdate:null,formfields:[],isLoading:!1,selectedApplicationToView:null,selectedApprover:[],isRolesLoading:!1,schools:[],isSchoolYearFetching:!1,selected_school_year:null,school_years:[],hasRequestError:null,selecated_school:null}},created(){this.getAllSchoolYears(),this.loadApplicationForms(),this.loadRequirements(),this.loadApprovers()},watch:{search(e,o){this.searchApplication()}},methods:{changeHandler(e){let o=this.school_years.find(r=>r.id==e.target.value);this.schools=o.schools,this.selecated_school=null,this.schools.length>0&&(this.selecated_school=this.schools[0].id)},async getAllSchoolYears(){this.isSchoolYearFetching=!0,await x.get("api/school-year-with-schools").then(e=>{this.school_years=e.data.data,this.school_years.length>0&&(this.selected_school_year=this.school_years[0].id,this.schools=this.school_years[0].schools,this.schools.length>0&&(this.selecated_school=this.schools[0].id))}).catch(e=>{this.hasRequestError='"Oops! It seems like there was an error when  fetchin information school year, Please check your network connection. o and try again. if you think it it was the system please do contact the developer'}).finally(()=>{this.isSchoolYearFetching=!1})},showSampleForm(e){this.selectedApplicationToView=e},async searchApplication(){await x.post("api/manage-applications/search",{search:this.search}).then(e=>{this.applicationforms=e.data.data})},async showTheFormToUpdate(e){this.isUpdatingMode=!0,this.formtitle=e.title,this.formfields=[],this.selectedRequirements=[],this.selectedApprover=[],e.fields.length>0&&e.fields.forEach(o=>{let r={id:o.id,name:o.name,index:o.index,type:o.type,collection_for_select:o.collection_for_select},a=[{id:1,name:"Text",value:"text",selected:!1},{id:2,name:"Email",value:"email",selected:!1},{id:3,name:"Select",value:"select",selected:!1},{id:4,name:"Number",value:"number",selected:!1},{id:5,name:"Text Area",value:"textarea",selected:!1}],s=[{id:1,name:"Users",value:"users",selected:!1},{id:2,name:"School",value:"schools",selected:!1},{id:3,name:"Department",value:"departments",selected:!1}];a.forEach(f=>{f.value==r.type&&(f.selected=!0)}),s.forEach(f=>{f.value==r.collection_for_select&&(f.selected=!0)});const m={id:r.id,fieldname:r.name,index:r.index,selectedtype:r.type,selecteddata:r.collection_for_select,fieldtypeOption:a,data:s};this.formfields.push(m),this.formfields.sort((f,S)=>f.index-S.index)}),e.requirements.length>0&&e.requirements.forEach(o=>{this.selectedRequirements.push(o.id)}),e.application_form_approvals.length>0&&(e.application_form_approvals.forEach(o=>{this.selectedApprover.push(o.role_id)}),console.log(this.selectedApprover)),this.formfields.forEach(o=>{o.selectedtype=="select"&&o.selecteddata}),this.selectedApplicationFormToUpdate=e.id,this.showForm=!0},async updateApplicatonForm(){this.isSaving=!0;let e=[],o=null;this.formfields.forEach(a=>{a.selectedtype=="select"&&(o=a.selecteddata),e.push({id:a.id,name:a.fieldname,index:a.index,type:a.selectedtype,collection_for_select:o})});const r={id:this.selectedApplicationFormToUpdate,title:this.formtitle,fields:e,requirements:this.selectedRequirements,approvers:this.selectedApprover};await x.post("api/manage-applications/update",r).then(a=>{console.log(a.data),this.validationError=null,this.showForm=!1,this.formtitle="",this.formfields=[],this.selectedRequirements=[],this.selectedApprover=[],this.selectedApplicationFormToUpdate=null,this.loadApplicationForms()}).catch(a=>{console.log(a),a.response.status===422?this.validationError=a.response.data.errors:this.requestError=a}).finally(()=>{this.isSaving=!1})},showTheForm(){this.isUpdatingMode=!1,this.formtitle="",this.formfields=[],this.selectedApprover=[],this.showForm=!0},makeApplicationPublic(e){let o=e.status=="Priavte "?"Public":"Private";this.customConfirmationDialog({title:"Are you sure do you want to change the status of this application form into "+o,text:"",confirmButtonText:"Yes ",passFunction:async()=>{this.isLoading=!0;let r="";e.status=="private"?r="public":r="private",x.post("api/manage-applications/make-application-public",{id:e.id,status:r}).then(a=>{this.loadApplicationForms()}).catch(a=>{this.requestError=a}).finally(()=>{this.isLoading=!1})}})},customConfirmationDialog({title:e="Are you sure?",text:o="You won't be able to revert this!",icon:r="warning",confirmButtonText:a="Yes, delete it!",passFunction:s,passCancelFunction:m}){this.$swal({title:e,text:o,icon:r,showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:a}).then(async f=>{f.isConfirmed&&s()})},async deleteAllSelectedApplicationForm(){this.customConfirmationDialog({title:"Are you sure do you want to delete selected application forms ?",passFunction:async()=>{await x.post("api/manage-applications/delete-selected",{applicationforms:this.selectedApplicationForms}).then(e=>{this.selectedApplicationForms=[],this.loadApplicationForms()}).catch(e=>{this.requestError=e}).finally(()=>{this.isDeleting=!1})}})},async loadApplicationForms(){this.isFetching=!0,await x.get("api/manage-applications").then(e=>{this.applicationforms=e.data.data}).catch(e=>{this.requestError=e}).finally(()=>{this.isFetching=!1})},async loadApprovers(){this.isRolesLoading=!0,await x.get("api/form/approvers").then(e=>{this.approvers=e.data.data}).catch(e=>{}).finally(()=>{this.isRolesLoading=!1})},async loadRequirements(){this.isRequirementLoading=!0,await x.get("api/manage-requirement").then(e=>{this.requirements=e.data.data}).catch(e=>{this.requestError=e}).finally(()=>{this.isRequirementLoading=!1})},closeTheForm(){this.showForm=!1},clearForm(){this.validationError=null},async createApplicationForm(){this.isSaving=!0;let e=[],o=null;this.formfields.forEach((a,s)=>{a.selectedtype=="select"&&(o=a.selecteddata),e.push({name:a.fieldname,index:s,type:a.selectedtype,collection_for_select:o})});const r={title:this.formtitle,fields:e,requirements:this.selectedRequirements,approvers:this.selectedApprover,school_year_id:this.selected_school_year};await x.post("api/manage-applications/create",r).then(a=>{console.log(a.data),this.validationError=null,this.showForm=!1,this.formtitle="",this.formfields=[],this.selectedRequirements=[],this.selectedApprover=[],this.loadApplicationForms()}).catch(a=>{console.log(a),a.response.status===422?this.validationError=a.response.data.errors:this.requestError=a}).finally(()=>{this.isSaving=!1})},removeField(e){this.formfields.splice(e,1)},handleAddFields(){const e=this.formfields.length+1,o={id:e,fieldname:"",index:e,selectedtype:"text",selecteddata:null,fieldtypeOption:[{id:1,name:"Text",value:"text",selected:!0},{id:2,name:"Email",value:"email",selected:!1},{id:3,name:"Select",value:"select",selected:!1},{id:4,name:"Number",value:"number",selected:!1},{id:5,name:"Text Area",value:"textarea",selected:!1}],data:[{id:1,name:"Users",value:"users",selected:!1},{id:2,name:"School",value:"schools",selected:!1},{id:3,name:"Department",value:"departments",selected:!1}]};this.formfields.push(o)},handleFieldTypeSelection(e,o,r){this.formfields[e].fieldtypeOption.forEach(a=>{a.selected=!1}),r.selected=!0,this.formfields[e].selectedtype=r.value},handleDdataSelection(e,o,r){this.formfields[e].data.forEach(a=>{a.selected=!1}),r.selected=!0,this.formfields[e].selecteddata=r.value,console.log(this.formfields[e].selectedtype),console.log(this.formfields[e].selecteddata)}}},p=e=>(K("data-v-592ed254"),e=e(),Q(),e),X=p(()=>t("i",{class:"fa-solid fa-plus mr-1"},null,-1)),Z=_(" Create Application Form "),$=p(()=>t("i",{class:"fa-regular fa-trash-can mr-2"},null,-1)),ee={class:"relative w-12 px-6 sm:w-16 sm:px-8 align-top py-4"},te=["value"],se={class:"whitespace-nowrap py-4 text-sm"},oe={class:"flex items-center"},le={class:"pl-1"},ie={class:"font-medium capitalize text-sm font-rubik pr-2 text-gray-900"},ae={class:"whitespace-nowrap py-4 align-top"},ne=p(()=>t("p",{class:"mb-2 font-bold uppercase"},"Requestments",-1)),re={key:0},ce={key:1},de=_("None"),he={key:2},pe=p(()=>t("p",{class:"mb-2 font-bold uppercase"},"Requestments",-1)),ue={class:"grid grid-cols-1 gap-1 break-words"},me={key:3},fe=p(()=>t("span",{class:"inline-flex rounded-full bg-green-100 mx-1 px-2 text-xs font-semibold leading-5 text-green-800"},"None",-1)),_e=[fe],ge={class:"whitespace-nowrap py-4 align-top"},ye={key:0,class:"grid grid-cols-1 gap-1 break-words"},ve=_(" None "),be={class:"align-top relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6"},we={class:"grid grid-cols-1"},xe=["onClick"],ke=p(()=>t("i",{class:"fa-solid fa-arrow-up-right-from-square mr-2"},null,-1)),Fe=_(" View "),Ae=[ke,Fe],Ce=["disabled","onClick"],Ee=p(()=>t("i",{class:"fa-regular fa-pen-to-square mr-2"},null,-1)),qe=_(" Update "),Se=[Ee,qe],Te={class:"mt-2"},Be=p(()=>t("p",{class:"text-base font-bold"},"School Year",-1)),Ve=_(" Empty "),Re=["value"],Ue=p(()=>t("p",{class:"text-base font-bold mt-4"},"Application Title",-1)),De={key:0,class:"text-xs text-red-500 mt-1"},Le={class:"mt-2"},Ne=["onClick"],Me=p(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),Ye=[Me],Ie={class:""},ze=p(()=>t("label",{class:"font-bold font-rubik"}," Field name ",-1)),Oe=["onUpdate:modelValue"],Pe={key:0,class:"text-xs text-red-500 mt-1"},je={class:"mt-2 flex justify-between"},He=p(()=>t("label",{class:"mb-1 font-bold font-rubik"}," Field type ",-1)),Ge={class:"grid grid-cols-5 gap-1"},Je=["onUpdate:modelValue","onChange"],Ke={class:"text-sm font-rubik"},Qe={class:"mt-2"},We={key:0,class:""},Xe=p(()=>t("p",{class:"mt-1 font-rubik font-bold"}," Choose data for select field ",-1)),Ze=["onUpdate:modelValue","onChange"],$e={class:"text-sm"},et={class:"flex justify-end"},tt=p(()=>t("i",{class:"fa-solid fa-plus mr-1"},null,-1)),st=_(),ot=p(()=>t("span",{class:"mr-1"}," Field ",-1)),lt={key:0,class:"min-h-23 h-24 flex items-center"},it={key:1,class:"mt-2"},at=p(()=>t("p",{class:"text-base font-bold"},"Requirement Check List",-1)),nt={class:""},rt={class:"flex items-center p-1 my-1"},ct=["value","id"],dt=["for"],ht={key:1,class:"min-h-23 h-24 flex items-center"},pt={key:2,class:"mt-2"},ut=p(()=>t("p",{class:"text-base font-bold"},"Authorize Roles for Approval",-1)),mt={class:"flex items-center p-1 my-1"},ft=["value"],_t=["for"],gt={class:"my-2 flex justify-end"},yt=_(" Close "),vt={key:0,class:"my-1 mx-2"},bt={key:1},wt=_(" Save "),xt=_(" Update "),kt=p(()=>t("p",{class:"font-rubik my-2 text-lg text-green-700 font-bold"}," View Only ",-1)),Ft={class:""},At=_(" Close ");function Ct(e,o,r,a,s,m){const f=u("TableButton"),S=u("BaseSearchInput"),U=u("BaseTableSetup"),F=u("StatusCard"),E=u("w-divider"),D=u("BaseTable"),L=u("NoDataCard"),N=u("BaseInput"),M=u("Button"),V=u("Loader1"),Y=u("BaseSpinner"),R=u("BaseDialog"),I=u("RequestError"),z=u("BaseErrorDialog"),O=u("FormComponent"),P=u("GlobalErrorCard"),j=u("BaseCard");return l(),v(j,{subtitle:"Manage Form"},{header:h(()=>[d(U,null,{"searchs-area":h(()=>[d(f,{class:"mr-2",onClick:m.showTheForm},{default:h(()=>[X,Z]),_:1},8,["onClick"]),d(S,{placeholder:"Search Name ...",modelValue:s.search,"onUpdate:modelValue":o[0]||(o[0]=i=>s.search=i)},null,8,["placeholder","modelValue"])]),"filters-area":h(()=>[]),"actions-area":h(()=>[s.selectedApplicationForms.length>0?(l(),v(f,{key:0,onClick:m.deleteAllSelectedApplicationForm,modelValue:s.selectedApplicationForms,"onUpdate:modelValue":o[1]||(o[1]=i=>s.selectedApplicationForms=i),mode:!0,class:"mr-2"},{default:h(()=>[$,_(" Selected ( "+y(s.selectedApplicationForms.length)+" ) ",1)]),_:1},8,["onClick","modelValue"])):q("",!0)]),_:1}),d(D,{thdata:["","Title","Body","Approvers ",""],isFetching:s.isFetching},{data:h(()=>[(l(!0),n(w,null,b(s.applicationforms,i=>(l(),n("tr",{key:i.id},[t("td",ee,[k(t("input",{"onUpdate:modelValue":o[2]||(o[2]=c=>s.selectedApplicationForms=c),value:i.id,type:"checkbox",class:"absolute left-4 top-1/2 -mt-2 h-4 w-4 accent-green-600 text-white rounded border-gray-200 sm:left-6"},null,8,te),[[C,s.selectedApplicationForms]])]),t("td",se,[t("div",oe,[t("div",le,[t("div",ie,y(i.title),1)])])]),t("td",ae,[ne,i.fields.length>0?(l(),n("div",re,[(l(!0),n(w,null,b(i.fields,c=>(l(),n("div",{key:c.id},[d(F,{class:"mb-1 bg-purple-700 text-white font-rubik uppercase"},{default:h(()=>[_(y(c.name),1)]),_:2},1024)]))),128))])):(l(),n("div",ce,[d(F,{class:"bg-gray-700 tett-white"},{default:h(()=>[de]),_:1})])),i.requirements.length>0?(l(),n("div",he,[d(E,{class:"my6 my-2 mr-10"}),pe,t("div",ue,[(l(!0),n(w,null,b(i.requirements,c=>(l(),n("div",{key:c.id},[d(F,{class:"bg-rose-700 text-white mb-1"},{default:h(()=>[_(y(c.name),1)]),_:2},1024)]))),128))])])):(l(),n("div",me,_e))]),t("td",ge,[i.application_form_approvals.length>0?(l(),n("div",ye,[(l(!0),n(w,null,b(i.application_form_approvals,c=>(l(),v(F,{class:"bg-green-700 text-white",key:c},{default:h(()=>[_(y(c.role_name),1)]),_:2},1024))),128))])):(l(),v(F,{key:1,class:"bg-gray-700 text-white capitalize"},{default:h(()=>[ve]),_:1}))]),t("td",be,[t("div",we,[t("button",{onClick:c=>m.showSampleForm(i.id),class:"mb-1 items-center rounded-md border outline:none border-gray-300 bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-30 mr-1"},Ae,8,xe),t("button",{disabled:s.selectedApplicationForms.length>0,onClick:c=>m.showTheFormToUpdate(i),type:"button",class:"mb-1 z-0 items-center rounded-md border outline:none border-gray-300 bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-30 mr-1"},Se,8,Ce)])])]))),128))]),_:1},8,["isFetching"])]),default:h(()=>[(l(),v(B,{to:"#app"},[d(R,{show:s.showForm,width:"800",preventClose:!0},{"c-content":h(()=>[t("section",Te,[t("div",null,[Be,s.school_years.length<=0?(l(),v(L,{key:0},{default:h(()=>[Ve]),_:1})):k((l(),n("select",{key:1,onChange:o[3]||(o[3]=(...i)=>m.changeHandler&&m.changeHandler(...i)),"onUpdate:modelValue":o[4]||(o[4]=i=>s.selected_school_year=i),class:"block w-full py-2 px-3 pr-8 rounded-md bg-white border border-gray-400 focus:outline-none focus:shadow-outline-green focus:border-green-500 sm:text-sm sm:leading-5"},[(l(!0),n(w,null,b(s.school_years,i=>(l(),n("option",{key:i.id,value:i.id}," SY. "+y(i.from)+" - "+y(i.to),9,Re))),128))],544)),[[G,s.selected_school_year]])])]),Ue,d(N,{modelValue:s.formtitle,"onUpdate:modelValue":o[5]||(o[5]=i=>s.formtitle=i)},null,8,["modelValue"]),s.validationError!=null&&s.validationError.title?(l(),n("p",De,y(s.validationError.title[0]),1)):q("",!0),t("div",Le,[(l(!0),n(w,null,b(s.formfields,(i,c)=>(l(),n("div",{key:i.id,class:"relative shadow mt-3 mb-4 border px-3 py-2 rounded bg-gray-100"},[t("div",null,[t("button",{onClick:g=>m.removeField(c),class:"closeButton flex items-center justify-center rounded-full bg-gray-400 cursor-pointer hover:scale-95"},Ye,8,Ne),t("div",Ie,[ze,k(t("input",{"onUpdate:modelValue":g=>s.formfields[c].fieldname=g,type:"text",class:"w-full p-1 border"},null,8,Oe),[[J,s.formfields[c].fieldname]]),s.validationError!=null&&s.validationError["fields."+c+".name"]?(l(),n("p",Pe,y(s.validationError["fields."+c+".name"][0]),1)):q("",!0)]),t("div",je,[t("div",null,[He,t("div",Ge,[(l(!0),n(w,null,b(i.fieldtypeOption,(g,T)=>(l(),n("label",{key:g.id,class:"inline-flex items-center rounded cursor-pointer"},[k(t("input",{"onUpdate:modelValue":A=>g.selected=A,onChange:A=>m.handleFieldTypeSelection(c,T,g),type:"checkbox",class:"mr-1 h-4 w-4 accent-green-600 text-white rounded border-gray-200 sm:left-6"},null,40,Je),[[C,g.selected]]),t("span",Ke,y(g.name),1)]))),128))]),t("div",Qe,[s.formfields[c].selectedtype=="select"?(l(),n("div",We,[Xe,d(E,{class:"my6 my-2"}),(l(!0),n(w,null,b(s.formfields[c].data,(g,T)=>(l(),n("label",{key:g,class:"mt-3 border cursor-pointer flex items-center px-2 py-1 rounded"},[k(t("input",{"onUpdate:modelValue":A=>g.selected=A,onChange:A=>m.handleDdataSelection(c,T,g),type:"checkbox",class:"mr-1 h-4 w-4 accent-green-600 text-white rounded border-gray-200 sm:left-6"},null,40,Ze),[[C,g.selected]]),t("span",$e,y(g.name),1)]))),128))])):q("",!0)])])])])]))),128)),t("div",et,[d(M,{class:"border bg-green-700 text-white font-bold rounded-full px-4 py-1 hover:shadow-lg",onClick:m.handleAddFields},{default:h(()=>[tt,st,ot]),_:1},8,["onClick"])]),s.isRequirementLoading?(l(),n("div",lt,[d(V)])):(l(),n("div",it,[at,d(E,{class:"my6"}),t("div",nt,[(l(!0),n(w,null,b(s.requirements,i=>(l(),n("div",{key:i.id},[t("div",rt,[k(t("input",{"onUpdate:modelValue":o[6]||(o[6]=c=>s.selectedRequirements=c),type:"checkbox",value:i.id,class:"w-4 h-4 accent-green-600 text-white mr-1 border-blue-700 border-2 cursor-pointer",id:i.id},null,8,ct),[[C,s.selectedRequirements]]),t("label",{for:i.id,class:"mr-1 capitalize cursor-pointer"},y(i.name),9,dt)])]))),128))])]))]),s.isRolesLoading?(l(),n("div",ht,[d(V)])):(l(),n("div",pt,[ut,d(E,{class:"my6"}),(l(!0),n(w,null,b(s.approvers,i=>(l(),n("div",{key:i},[t("div",mt,[k(t("input",{"onUpdate:modelValue":o[7]||(o[7]=c=>s.selectedApprover=c),value:i.id,type:"checkbox",class:"w-4 h-4 accent-green-600 text-white mr-1 border-blue-700 border-2 cursor-pointer"},null,8,ft),[[C,s.selectedApprover]]),t("label",{for:i.id,class:"mr-2 font-rubik capitalize cursor-pointer"},y(i.name),9,_t)])]))),128))])),t("div",gt,[d(f,{mode:"",class:"mr-2",onClick:m.closeTheForm},{default:h(()=>[yt]),_:1},8,["onClick"]),s.isSaving?(l(),n("div",vt,[d(Y)])):(l(),n("div",bt,[s.isUpdatingMode?(l(),v(f,{key:1,onClick:m.updateApplicatonForm},{default:h(()=>[xt]),_:1},8,["onClick"])):(l(),v(f,{key:0,onClick:m.createApplicationForm},{default:h(()=>[wt]),_:1},8,["onClick"]))]))])]),_:1},8,["show"])])),(l(),v(B,{to:"#app"},[d(z,{show:s.requestError!=null,width:"400",transition:"slide-fade-down"},{"c-content":h(()=>[d(I,{statusCode:s.requestError.statusCode,onClose:o[8]||(o[8]=i=>s.requestError=null),message:s.requestError.message},null,8,["statusCode","message"])]),"c-actions":h(()=>[]),_:1},8,["show"])])),(l(),v(B,{to:"#app"},[d(R,{class:"bg-gray-200",show:s.selectedApplicationToView!=null,width:"800",preventClose:!0},{"c-content":h(()=>[kt,d(O,{id:s.selectedApplicationToView},null,8,["id"]),t("div",Ft,[d(f,{mode:"",class:"mt-4",onClick:o[9]||(o[9]=i=>s.selectedApplicationToView=null)},{default:h(()=>[At]),_:1})])]),_:1},8,["show"])])),d(P,{onClose:o[10]||(o[10]=i=>s.hasRequestError=null),show:s.hasRequestError!=null},null,8,["show"])]),_:1})}const qt=H(W,[["render",Ct],["__scopeId","data-v-592ed254"]]);export{qt as default};
