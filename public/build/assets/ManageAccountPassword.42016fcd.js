import{_ as N,x as p,g as m,w as n,r as c,o as i,d as l,k as E,c as r,i as v,b as s,t as f,F as b,T as y,h as j,z as P,e as g}from"./app.bb9b3753.js";const z={data(){return{form:{email:"",password:""},validationError:{},search:"",filterBy:"none",users:[],schools:[],roles:[],selectedRoles:[],selectedRole:null,selectedUsers:[],isFetching:!1,isSchoolFetching:!1,isRoleFetching:!1,requestError:null,isSaving:!1,showRolesForm:!1,showConfirmationDialog:!1,showUpdateAccountForm:!1,selectedAccount:null,requestHasError:null,isConfirming:!1}},created(){this.loadUsers()},watch:{search(e,t){this.searchUser()}},methods:{async changePassword(){this.isConfirming=!0;let e=this.form.password,t={id:this.selectedAccount.id,password:e};await p.post("api/change-user-password",t).then(d=>{this.showConfirmationDialog=!1,this.showUpdateAccountForm=!1,this.selectedAccount=null,this.form.password="",this.showToast({title:"Succesfully Update"}),this.loadUsers()}).catch(d=>{this.showConfirmationDialog=!1,d.response.status===422?this.validationError=d.response.data.errors:this.requestHasError="Opp seems like there was an error when chnaging password, Try again or contact the developer if error keep occurig"}).finally(()=>{this.isConfirming=!1})},showToast({title:e="Succesfully Saved"}){this.$swal({position:"top-end",icon:"success",showConfirmButton:!1,title:e,timer:1700,toast:!0,width:"300px",customClass:{title:"text-red"}})},handleAccountSelection(e){this.selectedAccount=e,this.showUpdateAccountForm=!0},handleCloseSelection(){this.selectedAccount=null,this.showUpdateAccountForm=!1},handleRoleSelection(e,t){console.log(e),console.log(t),this.roles.forEach(d=>{d.isSelected=!1}),this.selectedRole=t.id,t.isSelected=!0},handleShowRolesForm(){if(this.showRolesForm=!0,this.selectedUsers.length>0){const e=[];this.selectedUsers.forEach(t=>{t.roles.forEach(d=>{e.includes(d.id)||e.push(d.id)})}),this.selectedRoles=e}},showToast({title:e="Succesfully Saved"}){this.$swal({position:"top-end",icon:"success",showConfirmButton:!1,title:e,timer:1700,toast:!0,width:"300px",customClass:{title:"text-red"}})},async changeUsersRoles(){const e=[];this.selectedUsers.forEach(t=>{e.push(t.id)}),this.isSaving=!0,await p.post("api/manage-users-roles/change-role-selected-user",{usersid:e,role:this.selectedRole}).then(t=>{this.selectedUsers=[],this.selectedRole=null,this.showRolesForm=!1,this.loadUsers()}).finally(()=>{this.isSaving=!1})},async LoadRoles(){this.isRoleFetching=!0,await p.get("api/manage-users-roles/get-roles").then(e=>{let t=[];e.data.data.forEach(d=>{let k={...d,isSelected:!1};t.push(k)}),this.roles=t}).finally(()=>{this.isRoleFetching=!1})},async filterUser(){await p.post("api/manage-users-roles/filter",{filter:this.filterBy}).then(e=>{console.log(e.data.data),this.users=e.data.data})},closeErrorDialog(){this.requestError=null},async loadSchool(){this.isSchoolFetching=!0,p.get("api/schools ").then(e=>{this.schools=e.data.data}).finally(()=>{this.isSchoolFetching=!1})},searchUser:_.debounce(async function(){await p.post("api/search-user-account",{search:this.search}).then(e=>{this.users=e.data.data})},300),async loadUsers(){this.isFetching=!0,await p.get("api/get-user-without-google").then(e=>{this.users=e.data.data}).catch(e=>{this.requestError=e}).finally(()=>{this.isFetching=!1})}}},I=g(" Update Account "),M={class:"whitespace-nowrap pl-6 py-4 text-s text-sm"},H={class:"font-rubik capitalize"},L={class:"whitespace-nowrap py-4 text-s text-sm"},O={class:"font-rubik capitalize"},W={class:"whitespace-nowrap py-4 text-s text-sm"},Y={class:"font-rubik capitalize"},G={class:"whitespace-nowrap py-4 text-s text-sm"},J=["onClick"],K=s("i",{class:"fa-regular fa-pen-to-square"},null,-1),Q=[K],X=s("p",{class:"text-base font-bold"},"Choose Roles",-1),Z={key:0,class:"flex justify-center my-4"},$={key:1,class:"grid p-2 grid-cols-3 gap-1"},ee={class:"flex items-center p-1"},se=["onChange","id","onUpdate:modelValue"],te=["for"],oe=s("div",{class:"mt-1"},[s("p",{class:"text-base font-bold"},"Selected Users")],-1),ae={class:""},le={class:"my-2 flex justify-end"},ie=g(" Close "),ne={key:0,class:"my-1 mx-2"},re={key:1},ce=g(" Confirm "),de=s("aside",{class:"rounded-lg flex item-center"},[s("div",{class:"rounded-l flex items-center justify-center w-36 bg-gradient-to-r from-blue-500 to-blue-600"},[s("i",{class:"fa-solid fa-triangle-exclamation text-4xl text-white"})]),s("div",{class:"rounded-r bg-gradient-to-r from-blue-500 to-blue-600 to-green-700 px-4 py-4"},[s("p",{class:"font-rubik text leading-5 text-white"}," We recommend to change password only if user are unable to access account or have forgotten password. ")])],-1),he={class:"mt-4"},ue=s("p",{class:"text-base font-bold"},"Enter New Pasword",-1),pe={class:"my-2 flex justify-end"},me=g(" Close "),fe={key:0,class:"my-1 mx-2"},_e={key:1},ge=g(" Update Account "),we={class:"my-2 flex justify-end"},ye=g(" No "),Ce={key:0,class:"my-1 mx-2"},xe={key:1},ve=g(" Yes ");function be(e,t,d,k,a,h){const u=c("TableButton"),F=c("BaseSearchInput"),B=c("BaseTableSetup"),R=c("BaseTable"),C=c("w-divider"),w=c("BaseSpinner"),x=c("BaseDialog"),A=c("RequestError"),D=c("BaseErrorDialog"),T=c("BaseInput"),V=c("ConfirmCard"),q=c("BaseCard");return i(),m(q,{subtitle:"Manage Users Account"},{header:n(()=>[l(B,null,{"searchs-area":n(()=>[a.selectedUsers.length?(i(),m(u,{key:0,class:"mr-2",onClick:h.handleShowRolesForm},{default:n(()=>[I]),_:1},8,["onClick"])):E("",!0),l(F,{placeholder:"Search Name ...",modelValue:a.search,"onUpdate:modelValue":t[0]||(t[0]=o=>a.search=o)},null,8,["placeholder","modelValue"])]),"filters-area":n(()=>[]),"actions-area":n(()=>[]),_:1}),l(R,{thdata:["Name","Email","Password",""],isFetching:a.isFetching},{data:n(()=>[(i(!0),r(b,null,v(a.users,o=>(i(),r("tr",{key:o.id},[s("td",M,[s("p",H,f(o.first_name)+" "+f(o.last_name),1)]),s("td",L,[s("p",O,f(o.email),1)]),s("td",W,[s("p",Y,f(o.password),1)]),s("td",G,[s("button",{onClick:S=>h.handleAccountSelection(o),type:"button",class:"inline-flex items-center rounded-md border outline:none border-gray-300 bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-30 mr-1"},Q,8,J)])]))),128))]),_:1},8,["isFetching"])]),default:n(()=>[(i(),m(y,{to:"#app"},[l(x,{show:a.showRolesForm,width:"500",preventClose:!0},{"c-content":n(()=>[X,l(C,{class:"my6"}),a.isRoleFetching?(i(),r("div",Z,[l(w)])):(i(),r("div",$,[(i(!0),r(b,null,v(a.roles,(o,S)=>(i(),r("div",{key:o.id},[s("div",ee,[j(s("input",{type:"checkbox",onChange:U=>h.handleRoleSelection(S,o),class:"w-4 h-4 accent-green-600 text-white mr-1 border-blue-700 border-2 cursor-pointer",id:o.id,"onUpdate:modelValue":U=>o.isSelected=U},null,40,se),[[P,o.isSelected]]),s("label",{for:o.id,class:"mr-1"},f(o.name),9,te)])]))),128))])),l(C,{class:"my6"}),s("div",null,[oe,(i(!0),r(b,null,v(a.selectedUsers,o=>(i(),r("p",{class:"bggray2 rounde text-xs font-light italic mt-1 p-1",key:o.id},[s("span",ae,f(o.first_name.toUpperCase())+" "+f(o.last_name.toUpperCase()),1)]))),128))]),l(C,{class:"my6 my-2"}),s("div",le,[l(u,{mode:"",class:"mr-2",onClick:t[1]||(t[1]=o=>a.showRolesForm=!1)},{default:n(()=>[ie]),_:1}),a.isSaving?(i(),r("div",ne,[l(w)])):(i(),r("div",re,[a.selectedRoles.length>0?(i(),m(u,{key:0,class:"",onClick:h.changeUsersRoles},{default:n(()=>[ce]),_:1},8,["onClick"])):E("",!0)]))])]),_:1},8,["show"])])),(i(),m(y,{to:"#app"},[l(D,{show:a.requestError!=null,width:"400",transition:"slide-fade-down"},{"c-content":n(()=>[l(A,{statusCode:a.requestError.statusCode,onClose:h.closeErrorDialog,message:a.requestError.message},null,8,["statusCode","onClose","message"])]),"c-actions":n(()=>[]),_:1},8,["show"])])),(i(),m(y,{to:"#app"},[l(x,{show:a.showUpdateAccountForm,width:"500",preventClose:!0},{"c-content":n(()=>[de,s("div",he,[ue,l(T,{modelValue:a.form.password,"onUpdate:modelValue":t[2]||(t[2]=o=>a.form.password=o),hasError:a.validationError.password},null,8,["modelValue","hasError"])]),s("div",pe,[l(u,{mode:"",class:"mr-2",onClick:h.handleCloseSelection},{default:n(()=>[me]),_:1},8,["onClick"]),a.isSaving?(i(),r("div",fe,[l(w)])):(i(),r("div",_e,[l(u,{class:"",onClick:t[3]||(t[3]=o=>a.showConfirmationDialog=!0)},{default:n(()=>[ge]),_:1})]))])]),_:1},8,["show"])])),(i(),m(y,{to:"#app"},[l(x,{show:a.showConfirmationDialog,width:"500",preventClose:!0},{"c-content":n(()=>[l(V,{title:"Are you sure do you want to update user account password?"}),s("div",we,[l(u,{mode:"",class:"mr-2",onClick:t[4]||(t[4]=o=>a.showConfirmationDialog=!1)},{default:n(()=>[ye]),_:1}),a.isConfirming?(i(),r("div",Ce,[l(w)])):(i(),r("div",xe,[l(u,{class:"",onClick:h.changePassword},{default:n(()=>[ve]),_:1},8,["onClick"])]))])]),_:1},8,["show"])]))]),_:1})}const Se=N(z,[["render",be]]);export{Se as default};
